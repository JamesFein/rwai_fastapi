# ä¸‹ä¸€æ­¥æ“ä½œæŒ‡å—

## å½“å‰ä¸­æ–­ä½ç½®

**æ–‡ä»¶ï¼š** `app/main.py`
**ä½ç½®ï¼š** ç¬¬48-57è¡Œï¼Œ`lifespan` å‡½æ•°ä¸­çš„é…ç½®éªŒè¯éƒ¨åˆ†ä¹‹å
**ä»»åŠ¡ï¼š** æ·»åŠ RAGé…ç½®ç®¡ç†å™¨åˆå§‹åŒ–ä»£ç 

## ç«‹å³éœ€è¦å®Œæˆçš„ä»£ç ä¿®æ”¹

### 1. å®Œæˆ app/main.py ä¿®æ”¹

åœ¨ `app/main.py` çš„ç¬¬57è¡Œä¹‹åæ·»åŠ ä»¥ä¸‹ä»£ç ï¼š

```python
    # åˆå§‹åŒ–RAGé…ç½®ç®¡ç†å™¨
    try:
        logger.info("ğŸ”§ åˆå§‹åŒ–RAGé…ç½®ç®¡ç†å™¨...")
        initialize_rag_config(settings)
        logger.info("âœ… RAGé…ç½®ç®¡ç†å™¨åˆå§‹åŒ–å®Œæˆ")
    except Exception as e:
        logger.error(f"âŒ RAGé…ç½®ç®¡ç†å™¨åˆå§‹åŒ–å¤±è´¥: {str(e)}")
        raise
```

**å…·ä½“æ“ä½œï¼š**
```bash
# ä½¿ç”¨str-replace-editorå·¥å…·ä¿®æ”¹æ–‡ä»¶
# åœ¨ç¬¬57è¡Œ "raise" ä¹‹åæ·»åŠ ä¸Šè¿°ä»£ç å—
```

## åç»­ä»»åŠ¡æ¸…å•

### é˜¶æ®µå››å‰©ä½™ä»»åŠ¡

#### 1. å®Œæ•´åŠŸèƒ½éªŒè¯æµ‹è¯•
**æ–‡ä»¶ä½ç½®ï¼š** `tests/test_end_to_end.py` (éœ€åˆ›å»º)
**å†…å®¹ï¼š**
- ç«¯åˆ°ç«¯æµ‹è¯•ï¼šæ–‡æ¡£ç´¢å¼• â†’ å¯¹è¯æŸ¥è¯¢ â†’ ç»“æœè¿”å›
- æµ‹è¯•æ–°æ—§APIå…¼å®¹æ€§
- éªŒè¯ç¯å¢ƒå˜é‡é…ç½®è¦†ç›–

#### 2. å‰ç«¯åŠŸèƒ½æµ‹è¯•
**æ“ä½œæ­¥éª¤ï¼š**
1. å¯åŠ¨åç«¯æœåŠ¡ï¼š`python -m uvicorn app.main:app --reload`
2. æ‰“å¼€å‰ç«¯ç•Œé¢
3. æµ‹è¯•åŠŸèƒ½ï¼š
   - æ–‡æ¡£ä¸Šä¼ å’Œç´¢å¼•å»ºç«‹
   - æ™ºèƒ½å¯¹è¯ï¼ˆä¸¤ç§æ¨¡å¼ï¼‰
   - è¯¾ç¨‹ææ–™ç®¡ç†
   - æ•°æ®æ¸…ç†åŠŸèƒ½

#### 3. æ€§èƒ½éªŒè¯
**æµ‹è¯•é¡¹ç›®ï¼š**
- ç´¢å¼•å»ºç«‹é€Ÿåº¦å¯¹æ¯”
- å¯¹è¯å“åº”æ—¶é—´å¯¹æ¯”
- å†…å­˜ä½¿ç”¨æƒ…å†µ
- å¹¶å‘å¤„ç†èƒ½åŠ›

## æµ‹è¯•éªŒè¯å‘½ä»¤

### è¿è¡Œæ‰€æœ‰æµ‹è¯•
```bash
# æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
.venv\Scripts\activate

# è¿è¡Œæ‰€æœ‰æµ‹è¯•
python -m pytest tests/ -v

# è¿è¡Œç‰¹å®šæµ‹è¯•
python -m pytest tests/test_rag_settings.py -v
python -m pytest tests/test_rag_services_integration.py -v
python -m pytest tests/test_api_v2_integration.py -v
```

### å¯åŠ¨æœåŠ¡å™¨
```bash
# å¼€å‘æ¨¡å¼å¯åŠ¨
python -m uvicorn app.main:app --reload --host 0.0.0.0 --port 8000

# æˆ–è€…ç›´æ¥è¿è¡Œ
python app/main.py
```

## ç¯å¢ƒå˜é‡æµ‹è¯•

### æµ‹è¯•RAGé…ç½®è¦†ç›–
```bash
# è®¾ç½®ç¯å¢ƒå˜é‡
set RAG_LLM_MODEL=gpt-4
set RAG_CHUNK_SIZE=1024
set RAG_REDIS_URL=redis://localhost:6380

# å¯åŠ¨æœåŠ¡éªŒè¯é…ç½®
python app/main.py
```

## APIæµ‹è¯•ç¤ºä¾‹

### æµ‹è¯•æ–°ç‰ˆæœ¬API

#### 1. æ–‡æ¡£ç´¢å¼•API v2
```bash
curl -X POST "http://localhost:8000/api/v1/rag/v2/index" \
  -H "Content-Type: multipart/form-data" \
  -F "file=@test.md" \
  -F "course_id=test_course" \
  -F "course_material_id=test_material" \
  -F "course_material_name=Test Material"
```

#### 2. å¯¹è¯API v2
```bash
curl -X POST "http://localhost:8000/api/v1/conversation/v2/chat" \
  -H "Content-Type: application/json" \
  -d '{
    "conversation_id": "test_conv",
    "question": "ä»€ä¹ˆæ˜¯Pythonï¼Ÿ",
    "chat_engine_type": "condense_plus_context",
    "course_id": "test_course"
  }'
```

#### 3. å¥åº·æ£€æŸ¥
```bash
curl "http://localhost:8000/api/v1/rag/v2/health"
curl "http://localhost:8000/api/v1/conversation/v2/health"
```

## é—®é¢˜æ’æŸ¥æŒ‡å—

### å¸¸è§é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ

#### 1. å¯¼å…¥é”™è¯¯
**ç—‡çŠ¶ï¼š** `ModuleNotFoundError`
**è§£å†³ï¼š** æ£€æŸ¥Pythonè·¯å¾„å’Œè™šæ‹Ÿç¯å¢ƒæ¿€æ´»

#### 2. é…ç½®åŠ è½½å¤±è´¥
**ç—‡çŠ¶ï¼š** RAGé…ç½®ç®¡ç†å™¨åˆå§‹åŒ–å¤±è´¥
**è§£å†³ï¼š** æ£€æŸ¥ç¯å¢ƒå˜é‡æ ¼å¼å’ŒAPIå¯†é’¥é…ç½®

#### 3. æ•°æ®åº“è¿æ¥é—®é¢˜
**ç—‡çŠ¶ï¼š** Qdrantè¿æ¥å¤±è´¥
**è§£å†³ï¼š** ç¡®ä¿QdrantæœåŠ¡è¿è¡Œåœ¨localhost:6334

#### 4. Redisè¿æ¥é—®é¢˜
**ç—‡çŠ¶ï¼š** å¯¹è¯å†…å­˜åˆ›å»ºå¤±è´¥
**è§£å†³ï¼š** ç¡®ä¿RedisæœåŠ¡è¿è¡Œåœ¨localhost:6379

## éªŒæ”¶æ ‡å‡†

### åŠŸèƒ½éªŒæ”¶
- [ ] æ‰€æœ‰å•å…ƒæµ‹è¯•é€šè¿‡
- [ ] æ‰€æœ‰é›†æˆæµ‹è¯•é€šè¿‡
- [ ] æ–°APIæ­£å¸¸å·¥ä½œ
- [ ] æ—§APIä»ç„¶å¯ç”¨ï¼ˆå¸¦deprecatedè­¦å‘Šï¼‰
- [ ] å‰ç«¯æ‰€æœ‰åŠŸèƒ½æ­£å¸¸

### æ€§èƒ½éªŒæ”¶
- [ ] å“åº”æ—¶é—´ä¸è¶…è¿‡åŸç³»ç»Ÿçš„120%
- [ ] å†…å­˜ä½¿ç”¨åˆç†
- [ ] æ— å†…å­˜æ³„æ¼

### é…ç½®éªŒæ”¶
- [ ] ç¯å¢ƒå˜é‡æ­£ç¡®è¦†ç›–é»˜è®¤é…ç½®
- [ ] é…ç½®é”™è¯¯æœ‰æ¸…æ™°çš„é”™è¯¯ä¿¡æ¯
- [ ] æœåŠ¡å¯åŠ¨æ—¥å¿—å®Œæ•´

## å®Œæˆæ ‡å¿—

å½“ä»¥ä¸‹æ‰€æœ‰é¡¹ç›®å®Œæˆæ—¶ï¼Œé‡æ„å·¥ä½œå³å‘Šå®Œæˆï¼š

1. âœ… åŸºç¡€è®¾æ–½é‡æ„
2. âœ… æœåŠ¡é‡æ„  
3. âœ… APIè·¯ç”±æ›´æ–°
4. ğŸ”„ é…ç½®å¢å¼ºå’Œæµ‹è¯•
   - [ ] ç¯å¢ƒå˜é‡æ”¯æŒ
   - [ ] å®Œæ•´åŠŸèƒ½éªŒè¯
   - [ ] å‰ç«¯æµ‹è¯•
   - [ ] æ€§èƒ½éªŒè¯

## ç´§æ€¥è”ç³»ä¿¡æ¯

**é‡è¦æ–‡ä»¶ä½ç½®ï¼š**
- é‡æ„è®¡åˆ’ï¼š`dev_docs/é‡æ„è®¡åˆ’.md`
- è¿›åº¦æŠ¥å‘Šï¼š`dev_docs/é‡æ„è¿›åº¦æŠ¥å‘Š.md`
- å½“å‰æŒ‡å—ï¼š`dev_docs/ä¸‹ä¸€æ­¥æ“ä½œæŒ‡å—.md`

**å…³é”®ä»£ç ä½ç½®ï¼š**
- RAGé…ç½®ï¼š`app/services/rag/rag_settings.py`
- æ–‡æ¡£ç´¢å¼•ï¼š`app/services/rag/document_indexing_service.py`
- å¯¹è¯æœåŠ¡ï¼š`app/services/rag/conversation_service.py`
- API v2ï¼š`app/api/v1/rag_v2.py`, `app/api/v1/conversation_v2.py`
